from classes.analyzers.Analyzer import Analyzer
from classes.snapshots.ProcessSnapshot import ProcessSnapshot
from classes.dataTypes.Changes import Changes
from loguru import logger
import wmi


class ProcessAnalyzer(Analyzer):
    def __init__(self):
        super().__init__()

    def resultText(self):
        logger.info("")
        logger.info("[!] These are the changes in the running process")

    def snapshot(self) -> list[ProcessSnapshot]:

        snapshots: list[ProcessSnapshot] = []

        f = wmi.WMI()

        for proc in f.Win32_Process():
            snap = ProcessSnapshot(proc.Name, proc.ProcessId)
            snapshots.append(snap)

        return snapshots

    def compare(self):

        allChanges = []

        for snap1 in self.snapshot1:
            if snap1 not in self.snapshot2:
                change = Changes(None, (snap1.processName, snap1.processId), None)
                allChanges.append(change)

        for snap2 in self.snapshot2:
            if snap2 not in self.snapshot1:
                change = Changes(None, None, (snap2.processName, snap2.processId))
                allChanges.append(change)

        self.difference = allChanges
