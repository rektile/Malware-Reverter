from classes.analyzers.AutoRunRegistryAnalyzer import AutoRunRegistryAnalyzer
from classes.analyzers.WindowsDefenderAnalyzer import WindowsDefenderAnalyzer
from classes.analyzers.ServiceRegistryAnalyzer import ServiceRegistryAnalyzer
from classes.analyzers.WindowsSchedulerAnalyzer import WindowsSchedulerAnalyzer
from classes.analyzers.StartupFolderAnalyzer import StartupFolderAnalyzer
from classes.utils import initLogger


class MalwareWatcher:
    def __init__(self):

        initLogger()

        self.analyzers = [
            AutoRunRegistryAnalyzer(),
            WindowsDefenderAnalyzer(),
            ServiceRegistryAnalyzer(),
            WindowsSchedulerAnalyzer(),
            StartupFolderAnalyzer()
        ]

    def makeSnapshots(self) -> list:

        for analyzer in self.analyzers:
            analyzer.makeSnapshot()

    def compareSnapshots(self):

        for analyzer in self.analyzers:
            analyzer.compare()

    def showResults(self):

        for analyzer in self.analyzers:
            analyzer.showResults()

    def run(self):

        print(f"[*] Making first snapshot...")

        self.makeSnapshots()

        input("[-] Press enter when you have fully executed the program. ")

        print(f"[*] Making second snapshot...")

        self.makeSnapshots()

        self.compareSnapshots()

        self.showResults()

        input("Press ENTER to close...")
